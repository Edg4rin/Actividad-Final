#include <stdio.h>
#include "pico/stdlib.h"
#include "hardware/i2c.h"

// Dirección I2C de la pantalla SSD1306
#define SSD1306_I2C_ADDRESS 0x3C

// Dimensiones de la pantalla OLED
#define OLED_WIDTH 128
#define OLED_HEIGHT 64

// Dimensiones de la fuente
#define FONT_HEIGHT 8
#define FONT_BWIDTH 1

// Matriz de cada letra específica para "ADOLFO CUEVAS"
const char FONT_SELECTED[27][FONT_HEIGHT * FONT_BWIDTH] = {
   { 0xF8,0x28,0x28,0x28,0xF8,0x00,0x00,0x00 },{ 0xF8,0xA8,0xA8,0xB8,0xE0,0x00,0x00,0x00 },{ 0xF8,0x88,0x88,0x88,0x88,0x00,0x00,0x00 },{ 0xF8,0x88,0x88,0x90,0xE0,0x00,0x00,0x00 },{ 0xF8,0xA8,0xA8,0xA8,0xA8,0x00,0x00,0x00 },{ 0xF8,0x28,0x28,0x28,0x28,0x00,0x00,0x00 },{ 0xF8,0x88,0xA8,0xA8,0xE8,0x00,0x00,0x00 },{ 0xF8,0x20,0x20,0x20,0xF8,0x00,0x00,0x00 },{ 0x00,0xF8,0x00,0x00,0x00,0x00,0x00,0x00 },{ 0xE0,0x80,0x80,0x80,0xF8,0x00,0x00,0x00 },{ 0xF8,0x00,0x20,0x50,0x88,0x00,0x00,0x00 },{ 0xF8,0x80,0x80,0x80,0x80,0x00,0x00,0x00 },{ 0xF8,0x08,0x08,0xF8,0x08,0x08,0xF8,0x00 },{ 0xF8,0x10,0x20,0x40,0xF8,0x00,0x00,0x00 },{ 0xF8,0x88,0x88,0x88,0xF8,0x00,0x00,0x00 },{ 0xF8,0x48,0x48,0x48,0x78,0x00,0x00,0x00 },{ 0xF8,0x88,0xE8,0x88,0xF8,0x00,0x00,0x00 },{ 0xF8,0x28,0x28,0x68,0xB8,0x00,0x00,0x00 },{ 0xB8,0xA8,0xA8,0xA8,0xE8,0x00,0x00,0x00 },{ 0x08,0x08,0xF8,0x08,0x08,0x00,0x00,0x00 },{ 0xF8,0x80,0x80,0x80,0xF8,0x00,0x00,0x00 },{ 0xF8,0x80,0x40,0x20,0x18,0x00,0x00,0x00 },{ 0xF8,0x80,0x80,0xF8,0x80,0x80,0xF8,0x00 },{ 0x88,0x50,0x20,0x50,0x88,0x00,0x00,0x00 },{ 0xB8,0xA0,0xA0,0xA0,0xF8,0x00,0x00,0x00 },{ 0x88,0xC8,0xA8,0x98,0x88,0x00,0x00,0x00 },{ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00 },};


// Inicialización de la pantalla SSD1306
void ssd1306_init() {
    uint8_t init_sequence[] = {
        0xAE, 0x20, 0x00, 0xB0, 0xC8, 0x00, 0x10, 0x40, 0x81, 0xFF,
        0xA1, 0xA6, 0xA8, 0x3F, 0xA4, 0xD3, 0x00, 0xD5, 0x80, 0xD9,
        0xF1, 0xDA, 0x12, 0xDB, 0x40, 0x8D, 0x14, 0xAF
    };
    for (int i = 0; i < sizeof(init_sequence); i++) {
        uint8_t data[2] = {0x00, init_sequence[i]};
        i2c_write_blocking(i2c_default, SSD1306_I2C_ADDRESS, data, 2, false);
    }
}

// Limpia el buffer de pantalla
void ssd1306_clear() {
    for (int page = 0; page < 8; page++) {
        uint8_t buffer[129];
        buffer[0] = 0x40; // Indicador de datos
        for (int i = 1; i < 129; i++) {
            buffer[i] = 0x00;
        }
        i2c_write_blocking(i2c_default, SSD1306_I2C_ADDRESS, buffer, 129, false);
    }
}

// Dibuja un carácter en una posición específica
void ssd1306_draw_char(const char *char_data, int x) {
    uint8_t data[FONT_HEIGHT + 1];
    data[0] = 0x40; // Indicador de datos
    for (int i = 0; i < FONT_HEIGHT; i++) {
        data[i + 1] = char_data[i];
    }
    i2c_write_blocking(i2c_default, SSD1306_I2C_ADDRESS, data, FONT_HEIGHT + 1, false);
}

// Escribe el nombre "ADOLFO CUEVAS" en la pantalla
void display_name_adolfo_cuevas() {
    int x = 0;
    ssd1306_draw_char(FONT_SELECTED[0], x);       // A
    ssd1306_draw_char(FONT_SELECTED[3], x + 8);   // D
    ssd1306_draw_char(FONT_SELECTED[14], x + 16);  // O
    ssd1306_draw_char(FONT_SELECTED[11], x + 24);  // L
    ssd1306_draw_char(FONT_SELECTED[5], x + 32);  // F
    ssd1306_draw_char(FONT_SELECTED[14], x + 40);  // O
    ssd1306_draw_char(FONT_SELECTED[26], x + 56);  // ESPACIO
    ssd1306_draw_char(FONT_SELECTED[2], x + 64);  // C
    ssd1306_draw_char(FONT_SELECTED[20], x + 72);  // U
    ssd1306_draw_char(FONT_SELECTED[4], x + 80);  // E
    ssd1306_draw_char(FONT_SELECTED[21], x + 88);  // V
    ssd1306_draw_char(FONT_SELECTED[0], x + 96);  // A
    ssd1306_draw_char(FONT_SELECTED[18], x + 104);  // S
}

int main() {
    stdio_init_all();
    i2c_init(i2c_default, 100 * 1000);
    gpio_set_function(PICO_DEFAULT_I2C_SDA_PIN, GPIO_FUNC_I2C);
    gpio_set_function(PICO_DEFAULT_I2C_SCL_PIN, GPIO_FUNC_I2C);
    gpio_pull_up(PICO_DEFAULT_I2C_SDA_PIN);
    gpio_pull_up(PICO_DEFAULT_I2C_SCL_PIN);

    // Inicialización y escritura en pantalla
    ssd1306_init();
    ssd1306_clear();
    display_name_adolfo_cuevas();

    while (true) {
        // Bucle principal vacío
    }
}
